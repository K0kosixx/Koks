
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MeowSquad</title>
  <style>
    :root{
      --bg1:#2b1a3b;
      --bg2:#3d2461;
      --accent:#b77cff;
      --accent2:#ff9cf3;
      --text:#f7eaff;
      --muted:#cbb8e8;
      --glass:rgba(255,255,255,0.08);
      --border:rgba(255,255,255,0.18);
      --card:#3a235a;
      --ok:#76ffa8;
      --warn:#ffd27a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 600px at 20% 0%, var(--bg2) 0%, var(--bg1) 45%, #1a1026 100%);
      overflow-x:hidden;
    }
    /* 3D-ish animated background canvas */
    #space{
      position:fixed; inset:0; z-index:-1; filter:saturate(1.2) blur(0.2px);
    }

    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(25,15,40,0.65), rgba(25,15,40,0.35));
      border-bottom:1px solid var(--border);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:16px}
    .brand{
      display:flex; align-items:center; gap:14px;
    }
    .brand svg{width:54px; height:54px; flex:0 0 auto; filter:drop-shadow(0 2px 6px rgba(0,0,0,0.5))}
    .brand-title{
      display:flex; flex-direction:column; line-height:1.1;
    }
    .brand-title .name{
      font-weight:800; font-size:24px; letter-spacing:0.5px; color:var(--accent);
      text-shadow: 0 0 8px rgba(183,124,255,0.55);
    }
    .brand-title .tag{
      font-size:12px; color:var(--muted);
    }

    nav{
      display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;
    }
    .tab-btn{
      appearance:none; border:none; cursor:pointer;
      color:var(--text);
      padding:10px 14px; border-radius:10px;
      background:linear-gradient(180deg, var(--glass), rgba(255,255,255,0.03));
      border:1px solid var(--border);
      transition:transform .08s ease, background .2s ease, box-shadow .2s ease;
      box-shadow:0 2px 8px rgba(0,0,0,0.35);
    }
    .tab-btn.active{
      background:linear-gradient(180deg, rgba(183,124,255,0.25), rgba(255,156,243,0.15));
      border-color: rgba(255,156,243,0.45);
    }
    .actions{
      margin-left:auto; display:flex; gap:8px; flex-wrap:wrap;
    }
    .pill{
      font-size:12px; color:var(--muted);
      background:rgba(255,255,255,0.06);
      border:1px dashed var(--border);
      padding:6px 10px; border-radius:999px;
    }
    .btn{
      appearance:none; border:none; cursor:pointer;
      color:var(--text);
      padding:10px 14px; border-radius:10px;
      background:linear-gradient(180deg, var(--glass), rgba(255,255,255,0.03));
      border:1px solid var(--border);
      transition:transform .08s ease, background .2s ease, box-shadow .2s ease;
      box-shadow:0 2px 8px rgba(0,0,0,0.35);
    }
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{
      background:linear-gradient(180deg, rgba(183,124,255,0.35), rgba(255,156,243,0.18));
      border-color: rgba(255,156,243,0.45);
    }

    main{padding:20px 0 60px}
    section{display:none}
    section.active{display:block}

    .panel{
      background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border:1px solid var(--border);
      border-radius:16px;
      padding:18px;
      box-shadow:0 6px 28px rgba(0,0,0,0.35);
    }

    /* About */
    .about-grid{
      display:grid; grid-template-columns: 1.2fr 0.8fr; gap:18px;
    }
    .stat{
      display:flex; align-items:center; gap:12px; padding:10px 12px;
      background:rgba(255,255,255,0.05); border:1px solid var(--border); border-radius:12px;
    }
    .stat .num{font-weight:800; font-size:20px; color:var(--ok)}
    .stat .label{font-size:12px; color:var(--muted)}

    /* Members */
    .members-toolbar{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:12px;
    }
    .grid{
      display:grid; grid-template-columns: repeat(3, 1fr); gap:16px;
    }
    @media (max-width:980px){ .grid{grid-template-columns: repeat(2, 1fr);} .about-grid{grid-template-columns:1fr} }
    @media (max-width:560px){ .grid{grid-template-columns: 1fr;} nav{flex-direction:column} .actions{margin-left:0} }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border:1px solid var(--border);
      border-radius:16px; padding:14px;
      box-shadow:0 6px 24px rgba(0,0,0,0.35);
      display:flex; gap:12px; align-items:center;
      transition:transform .08s ease;
    }
    .card:hover{transform:translateY(-2px)}
    .skin{
      width:72px; height:72px; border-radius:12px; overflow:hidden;
      background:var(--card); border:1px solid var(--border);
      flex:0 0 auto;
    }
    .info{flex:1 1 auto}
    .nick{font-weight:700}
    .role{font-size:12px; color:var(--muted)}
    .contact{font-size:12px; color:var(--muted); margin-top:4px}
    .more{flex:0 0 auto}

    /* Modal */
    .modal-back{position:fixed; inset:0; background:rgba(0,0,0,0.5); display:none; align-items:center; justify-content:center; z-index:100}
    .modal{width:min(680px, 92vw); background:linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03)); border:1px solid var(--border); border-radius:18px; padding:16px}
    .modal-head{display:flex; align-items:center; gap:12px; margin-bottom:10px}
    .modal-actions{display:flex; gap:8px; margin-top:8px}
    .modal .skin{width:92px; height:92px}
    .modal .field{margin:8px 0}
    .modal label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    .modal input, .modal textarea, .modal select{
      width:100%; padding:10px; border-radius:10px; border:1px solid var(--border);
      background:rgba(255,255,255,0.06); color:var(--text)
    }
    .modal textarea{min-height:90px; resize:vertical}

    /* Admin badge */
    .admin-badge{
      font-size:11px; color:#241637; background:linear-gradient(90deg, var(--accent), var(--accent2));
      padding:6px 8px; border-radius:999px; font-weight:700;
      box-shadow:0 2px 10px rgba(183,124,255,0.35);
    }

    /* Footer */
    footer{
      margin-top:30px; padding:16px; text-align:center; color:var(--muted)
    }

    /* Small helpers */
    .hidden{display:none !important}
    .spacer{flex:1}
    .note{font-size:12px; color:var(--muted)}
  </style>
</head>
<body>
<canvas id="space"></canvas>

<header>
  <div class="wrap">
    <div class="brand">
      <!-- Anime-style kawaii cat mascot (purple) -->
      <svg viewBox="0 0 120 120" aria-hidden="true">
        <defs>
          <linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#b77cff"/>
            <stop offset="100%" stop-color="#ff9cf3"/>
          </linearGradient>
        </defs>
        <g transform="translate(60,60)">
          <!-- Head -->
          <circle r="40" fill="url(#g1)" />
          <!-- Ears -->
          <path d="M-32 -10 L-48 -40 L-14 -24 Z" fill="#d69cff"/>
          <path d="M32 -10 L48 -40 L14 -24 Z" fill="#d69cff"/>
          <!-- Inner ears -->
          <path d="M-30 -16 L-42 -34 L-18 -26 Z" fill="#ffd1fa"/>
          <path d="M30 -16 L42 -34 L18 -26 Z" fill="#ffd1fa"/>
          <!-- Eyes (anime sparkle) -->
          <ellipse cx="-16" cy="-2" rx="7" ry="9" fill="#1a1026"/>
          <circle cx="-18" cy="-5" r="2.8" fill="#ffffff"/>
          <ellipse cx="16" cy="-2" rx="7" ry="9" fill="#1a1026"/>
          <circle cx="14" cy="-5" r="2.8" fill="#ffffff"/>
          <!-- Nose -->
          <circle cx="0" cy="8" r="2.4" fill="#5a2a85"/>
          <!-- Mouth -->
          <path d="M-4 14 Q0 18 4 14" stroke="#5a2a85" stroke-width="2.5" fill="none" stroke-linecap="round"/>
          <!-- Whiskers -->
          <path d="M-22 8 L-40 6" stroke="#5a2a85" stroke-width="2" />
          <path d="M-22 12 L-40 14" stroke="#5a2a85" stroke-width="2" />
          <path d="M22 8 L40 6" stroke="#5a2a85" stroke-width="2" />
          <path d="M22 12 L40 14" stroke="#5a2a85" stroke-width="2" />
          <!-- Blush -->
          <ellipse cx="-26" cy="10" rx="6" ry="4" fill="#ffb7e8" opacity="0.8"/>
          <ellipse cx="26" cy="10" rx="6" ry="4" fill="#ffb7e8" opacity="0.8"/>
        </g>
      </svg>
      <div class="brand-title">
        <div class="name">MeowSquad</div>
        <div class="tag">Каваи-клан • фиолетовые оттенки • мяу</div>
      </div>
      <div class="spacer"></div>
      <div class="actions">
        <span id="adminState" class="pill">Режим: гость</span>
        <button class="btn" id="adminLogin">Войти как админ</button>
        <button class="btn" id="dataExport">Экспорт</button>
        <button class="btn" id="dataImport">Импорт</button>
      </div>
    </div>

    <nav>
      <button class="tab-btn active" data-tab="about">О нас</button>
      <button class="tab-btn" data-tab="members">Участники</button>
      <button class="tab-btn" data-tab="contacts">Контакты</button>
      <div class="spacer"></div>
      <div class="pill">Вместе: 1 год • Размер клана: 10</div>
    </nav>
  </div>
</header>

<main class="wrap">
  <section id="about" class="active">
    <div class="panel">
      <h2>О нас</h2>
      <p>Мы — MeowSquad. Любим фиолетовые неоны, милый стиль и игры: Minecraft и не только. Мы ценим дружбу, заботу и весёлые мяу-моменты. Здесь есть место креативу, доброте и чуточке магии.</p>
      <div class="about-grid" style="margin-top:12px">
        <div>
          <div class="stat"><span class="num">10</span><span class="label">участников</span></div>
          <div class="stat"><span class="num">1 год</span><span class="label">вместе</span></div>
          <div class="stat"><span class="num">∞</span><span class="label">мяу и улыбок</span></div>
        </div>
        <div>
          <div class="panel">
            <h3>Ценности</h3>
            <ul>
              <li><b>Доброта:</b> поддержка и уважение друг к другу.</li>
              <li><b>Креатив:</b> строим, творим, делимся идеями.</li>
              <li><b>Команда:</b> вместе побеждаем и растём.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="members">
    <div class="panel">
      <div class="members-toolbar">
        <h2 style="margin:0">Участники</h2>
        <div class="spacer"></div>
        <button class="btn primary" id="addMember">Добавить участника</button>
        <span class="note">Добавлять участников может только админ (пароль: Kokos2205)</span>
      </div>

      <div id="membersGrid" class="grid"></div>
    </div>
  </section>

  <section id="contacts">
    <div class="panel">
      <h2>Контакты</h2>
      <ul>
        <li><b>Связь:</b> Discord, Telegram, или почта — как удобно.</li>
        <li><b>Заявки в клан:</b> напишите свой ник и почему хотите к нам.</li>
        <li><b>Предложения:</b> идеи по развитию сайта и сообщества приветствуются.</li>
      </ul>
    </div>
  </section>
</main>

<footer>
  © MeowSquad • сделано с любовью и мяу
</footer>

<!-- Full profile modal -->
<div class="modal-back" id="profileBack">
  <div class="modal">
    <div class="modal-head">
      <canvas class="skin" id="profileSkin"></canvas>
      <div>
        <div id="profileNick" class="nick"></div>
        <div id="profileRole" class="role"></div>
        <div id="profileContact" class="contact"></div>
      </div>
      <div class="spacer"></div>
      <button class="btn" id="closeProfile">Закрыть</button>
    </div>
    <div class="field">
      <label>О себе</label>
      <div id="profileAbout" class="note"></div>
    </div>
  </div>
</div>

<!-- Add/Edit member modal -->
<div class="modal-back" id="editBack">
  <div class="modal">
    <div class="modal-head">
      <canvas class="skin" id="editSkin"></canvas>
      <div>
        <div class="admin-badge">Режим админа</div>
        <div class="note">Введите ник для загрузки скина (NameMC совместим)</div>
      </div>
      <div class="spacer"></div>
      <button class="btn" id="closeEdit">Отмена</button>
      <button class="btn primary" id="saveMember">Сохранить</button>
    </div>
    <div class="field">
      <label>Никнейм (Minecraft)</label>
      <input id="fNick" placeholder="Например: Notch" />
    </div>
    <div class="field">
      <label>Роль</label>
      <input id="fRole" placeholder="Игрок / Строитель / Лидер" />
    </div>
    <div class="field">
      <label>Контакт</label>
      <input id="fContact" placeholder="Discord, Telegram или почта" />
    </div>
    <div class="field">
      <label>О себе</label>
      <textarea id="fAbout" placeholder="Коротко о себе..."></textarea>
    </div>
    <div class="field">
      <label>Источник скина</label>
      <select id="fSkinSource">
        <option value="mojang">По нику (Mojang)</option>
        <option value="url">Прямая ссылка на PNG</option>
      </select>
    </div>
    <div class="field">
      <label>Скин PNG URL (если выбрано 'Прямая ссылка')</label>
      <input id="fSkinURL" placeholder="https://.../skin.png" />
    </div>
    <div class="modal-actions">
      <button class="btn" id="fetchSkin">Загрузить скин</button>
      <span class="note" id="skinStatus"></span>
    </div>
  </div>
</div>

<script>
  // --- Simple tab switching
  document.querySelectorAll('.tab-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      const tab = btn.dataset.tab;
      document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
      document.getElementById(tab).classList.add('active');
      meow(); // a little meow on tab switch
    });
  });

  // --- Admin login (client-side gate)
  let isAdmin = false;
  const adminState = document.getElementById('adminState');
  document.getElementById('adminLogin').addEventListener('click', ()=>{
    const p = prompt('Введите пароль админа:');
    if(p === 'Kokos2205'){
      isAdmin = true;
      adminState.textContent = 'Режим: админ';
      adminState.classList.add('admin-badge');
      meow();
    }else{
      alert('Неверный пароль');
    }
  });

  // --- Local storage for members
  const LS_KEY = 'meowsquad_members';
  function loadMembers(){
    try{
      return JSON.parse(localStorage.getItem(LS_KEY)) || [];
    }catch(e){ return []; }
  }
  function saveMembers(list){
    localStorage.setItem(LS_KEY, JSON.stringify(list));
  }
  let members = loadMembers();

  // Seed example members if empty
  if(members.length === 0){
    members = [
      {nick:'MeowLeader', role:'Лидер', contact:'Discord: meow#0001', about:'Люблю строить и мяукать.', skinUrl:null, headData:null},
      {nick:'KawaiiCat', role:'Строитель', contact:'Telegram: @kawaii', about:'Фиолетовые неоны навсегда.', skinUrl:null, headData:null},
    ];
    saveMembers(members);
  }

  // --- Render members grid
  const grid = document.getElementById('membersGrid');
  function renderGrid(){
    grid.innerHTML = '';
    members.forEach((m, idx)=>{
      const card = document.createElement('div');
      card.className = 'card';

      const canvas = document.createElement('canvas');
      canvas.className = 'skin';
      canvas.width = 72; canvas.height = 72;

      const info = document.createElement('div'); info.className='info';
      const more = document.createElement('div'); more.className='more';

      const nick = document.createElement('div'); nick.className='nick'; nick.textContent = m.nick;
      const role = document.createElement('div'); role.className='role'; role.textContent = m.role || '';
      const contact = document.createElement('div'); contact.className='contact'; contact.textContent = m.contact || '';

      const btnView = document.createElement('button'); btnView.className='btn'; btnView.textContent='Профиль';
      btnView.addEventListener('click', ()=>openProfile(idx));
      more.appendChild(btnView);

      if(isAdmin){
        const btnEdit = document.createElement('button'); btnEdit.className='btn'; btnEdit.textContent='Редактировать';
        btnEdit.style.marginLeft='6px';
        btnEdit.addEventListener('click', ()=>openEdit(idx));
        more.appendChild(btnEdit);
      }

      info.appendChild(nick);
      info.appendChild(role);
      info.appendChild(contact);

      card.appendChild(canvas);
      card.appendChild(info);
      card.appendChild(more);
      grid.appendChild(card);

      drawHead(canvas, m.headData);
    });
  }

  // --- Profile modal
  const profileBack = document.getElementById('profileBack');
  const profileNick = document.getElementById('profileNick');
  const profileRole = document.getElementById('profileRole');
  const profileContact = document.getElementById('profileContact');
  const profileAbout = document.getElementById('profileAbout');
  const profileSkin = document.getElementById('profileSkin');
  profileSkin.width = 92; profileSkin.height = 92;
  document.getElementById('closeProfile').addEventListener('click', ()=>{ profileBack.style.display='none'; });

  function openProfile(idx){
    const m = members[idx];
    profileNick.textContent = m.nick;
    profileRole.textContent = m.role || '';
    profileContact.textContent = m.contact || '';
    profileAbout.textContent = m.about || '';
    drawHead(profileSkin, m.headData);
    profileBack.style.display='flex';
    meow();
  }

  // --- Edit modal
  const editBack = document.getElementById('editBack');
  const fNick = document.getElementById('fNick');
  const fRole = document.getElementById('fRole');
  const fContact = document.getElementById('fContact');
  const fAbout = document.getElementById('fAbout');
  const fSkinSource = document.getElementById('fSkinSource');
  const fSkinURL = document.getElementById('fSkinURL');
  const editSkin = document.getElementById('editSkin');
  editSkin.width = 92; editSkin.height = 92;
  const skinStatus = document.getElementById('skinStatus');
  let editIndex = null;

  document.getElementById('addMember').addEventListener('click', ()=>{
    if(!isAdmin){ alert('Только админ может добавлять участников.'); return; }
    editIndex = null;
    fNick.value=''; fRole.value=''; fContact.value=''; fAbout.value='';
    fSkinURL.value=''; fSkinSource.value='mojang';
    drawHead(editSkin, null);
    editBack.style.display='flex';
    meow();
  });
  document.getElementById('closeEdit').addEventListener('click', ()=>{ editBack.style.display='none'; });

  function openEdit(idx){
    if(!isAdmin){ alert('Только админ может редактировать.'); return; }
    editIndex = idx;
    const m = members[idx];
    fNick.value = m.nick || '';
    fRole.value = m.role || '';
    fContact.value = m.contact || '';
    fAbout.value = m.about || '';
    fSkinSource.value = m.skinUrl ? 'url' : 'mojang';
    fSkinURL.value = m.skinUrl || '';
    drawHead(editSkin, m.headData);
    editBack.style.display='flex';
    meow();
  }

  document.getElementById('saveMember').addEventListener('click', ()=>{
    const mem = {
      nick: fNick.value.trim(),
      role: fRole.value.trim(),
      contact: fContact.value.trim(),
      about: fAbout.value.trim(),
      skinUrl: fSkinSource.value === 'url' ? (fSkinURL.value.trim() || null) : null,
      headData: currentHeadData // from last fetch/draw
    };
    if(!mem.nick){ alert('Нужен ник.'); return; }

    if(editIndex===null){ members.push(mem); } else { members[editIndex] = mem; }
    saveMembers(members);
    renderGrid();
    editBack.style.display='none';
    meow();
  });

  // --- Fetch skin by nickname (Mojang endpoints — NameMC-compatible)
  let currentHeadData = null;
  document.getElementById('fetchSkin').addEventListener('click', async ()=>{
    skinStatus.textContent = '';
    currentHeadData = null;
    try{
      if(fSkinSource.value === 'mojang'){
        const name = fNick.value.trim();
        if(!name){ skinStatus.textContent='Введите ник.'; return; }
        const uuidResp = await fetch(`https://api.mojang.com/users/profiles/minecraft/${encodeURIComponent(name)}`);
        if(!uuidResp.ok){ skinStatus.textContent='Ник не найден.'; return; }
        const uuidData = await uuidResp.json();
        const profResp = await fetch(`https://sessionserver.mojang.com/session/minecraft/profile/${uuidData.id}?unsigned=false`);
        if(!profResp.ok){ skinStatus.textContent='Профиль не найден.'; return; }
        const profData = await profResp.json();
        const prop = profData.properties && profData.properties[0];
        if(!prop){ skinStatus.textContent='Скин не найден.'; return; }
        const val = JSON.parse(atob(prop.value));
        const skinUrl = val.textures?.SKIN?.url;
        if(!skinUrl){ skinStatus.textContent='Скин отсутствует.'; return; }
        const img = await loadImage(skinUrl);
        currentHeadData = extractHead(img);
        drawHead(editSkin, currentHeadData);
        skinStatus.textContent = 'Скин загружен';
      }else{
        const url = fSkinURL.value.trim();
        if(!url){ skinStatus.textContent='Введите URL PNG.'; return; }
        const img = await loadImage(url);
        currentHeadData = extractHead(img);
        drawHead(editSkin, currentHeadData);
        skinStatus.textContent = 'Скин загружен';
      }
    }catch(e){
      skinStatus.textContent = 'Ошибка загрузки скина.';
    }
  });

  function loadImage(url){
    return new Promise((resolve,reject)=>{
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.onload = ()=>resolve(img);
      img.onerror = reject;
      img.src = url;
    });
  }

  // Extract head (8x8 face + overlay) from skin PNG 64x64 or 128x128
  function extractHead(img){
    const w = img.naturalWidth, h = img.naturalHeight;
    const scale = w>=128 ? 2 : 1;
    // base head region (x=8..15,y=8..15), overlay (x=40..47,y=8..15)
    const canvas = document.createElement('canvas');
    canvas.width = 8*scale; canvas.height = 8*scale;
    const ctx = canvas.getContext('2d');
    ctx.imageSmoothingEnabled = false;
    ctx.drawImage(img, 8*scale, 8*scale, 8*scale, 8*scale, 0, 0, 8*scale, 8*scale);
    // overlay
    ctx.drawImage(img, 40*scale, 8*scale, 8*scale, 8*scale, 0, 0, 8*scale, 8*scale);
    // return image data
    return canvas;
  }

  function drawHead(canvas, headCanvas){
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(!headCanvas){
      // placeholder cute gradient
      const g = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
      g.addColorStop(0,'#b77cff'); g.addColorStop(1,'#ff9cf3');
      ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width,canvas.height);
      // kitty face
      ctx.fillStyle = '#1a1026';
      ctx.beginPath(); ctx.arc(canvas.width*0.35, canvas.height*0.45, 5, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(canvas.width*0.65, canvas.height*0.45, 5, 0, Math.PI*2); ctx.fill();
      ctx.strokeStyle = '#5a2a85'; ctx.lineWidth=2;
      ctx.beginPath(); ctx.moveTo(canvas.width*0.40, canvas.height*0.65); ctx.quadraticCurveTo(canvas.width*0.50, canvas.height*0.72, canvas.width*0.60, canvas.height*0.65); ctx.stroke();
      return;
    }
    // upscale headCanvas to fit
    ctx.imageSmoothingEnabled = false;
    const size = Math.min(canvas.width, canvas.height);
    ctx.drawImage(headCanvas, 0, 0, headCanvas.width, headCanvas.height, (canvas.width-size)/2, (canvas.height-size)/2, size, size);
    // cute border
    ctx.strokeStyle = 'rgba(255,156,243,0.65)'; ctx.lineWidth=3; ctx.strokeRect(1.5,1.5,canvas.width-3,canvas.height-3);
  }

  // --- Export / Import
  document.getElementById('dataExport').addEventListener('click', ()=>{
    const data = JSON.stringify(members, null, 2);
    navigator.clipboard?.writeText(data);
    alert('Данные участников скопированы в буфер обмена.');
  });
  document.getElementById('dataImport').addEventListener('click', ()=>{
    const data = prompt('Вставьте JSON с участниками:');
    if(!data) return;
    try{
      const parsed = JSON.parse(data);
      if(Array.isArray(parsed)){
        members = parsed;
        saveMembers(members);
        renderGrid();
        alert('Импорт завершён.');
      }else{
        alert('Неверный формат.');
      }
    }catch(e){ alert('Ошибка JSON.'); }
  });

  // --- Meow sound via WebAudio (synthetic short meow)
  let audioCtx;
  function meow(){
    try{
      if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = 'triangle';
      o.frequency.setValueAtTime(520, audioCtx.currentTime);
      o.frequency.exponentialRampToValueAtTime(330, audioCtx.currentTime+0.18);
      g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.08, audioCtx.currentTime+0.02);
      g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.22);
      o.connect(g).connect(audioCtx.destination);
      o.start(); o.stop(audioCtx.currentTime+0.24);
    }catch(e){}
  }

  // --- 3D-like animated background (parallax particles)
  const canvas = document.getElementById('space');
  const ctx = canvas.getContext('2d');
  let W=innerWidth,H=innerHeight;
  canvas.width=W; canvas.height=H;
  let mouseX=W/2, mouseY=H/2;
  window.addEventListener('resize', ()=>{ W=innerWidth; H=innerHeight; canvas.width=W; canvas.height=H; });
  window.addEventListener('mousemove', (e)=>{ mouseX=e.clientX; mouseY=e.clientY; });

  const particles = [];
  const COLORS = ['#b77cff','#ff9cf3','#9f79ff','#7b5bd6','#e2b8ff'];
  for(let i=0;i<120;i++){
    particles.push({
      x: Math.random()*W, y: Math.random()*H,
      z: Math.random()*1.0 + 0.2,
      r: Math.random()*2+0.8,
      c: COLORS[Math.floor(Math.random()*COLORS.length)],
      dx: (Math.random()-0.5)*0.2,
      dy: (Math.random()-0.5)*0.2
    });
  }
  function draw(){
    ctx.clearRect(0,0,W,H);
    const cx = (mouseX/W - 0.5)*8;
    const cy = (mouseY/H - 0.5)*8;
    for(const p of particles){
      p.x += p.dx*p.z; p.y += p.dy*p.z;
      if(p.x< -20) p.x=W+20; if(p.x>W+20) p.x=-20;
      if(p.y< -20) p.y=H+20; if(p.y>H+20) p.y=-20;
      const x = p.x + cx*20*p.z;
      const y = p.y + cy*20*p.z;
      const r = p.r*(1.2+(p.z*0.6));
      ctx.beginPath();
      ctx.fillStyle = p.c;
      ctx.globalAlpha = 0.6*(0.6+p.z*0.4);
      ctx.arc(x,y,r,0,Math.PI*2);
      ctx.fill();
    }
    // soft vignette
    const g = ctx.createRadialGradient(W/2,H/2, Math.min(W,H)*0.15, W/2,H/2, Math.max(W,H)*0.6);
    g.addColorStop(0,'rgba(255,255,255,0)');
    g.addColorStop(1,'rgba(0,0,0,0.25)');
    ctx.globalAlpha=1; ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
    requestAnimationFrame(draw);
  }
  draw();

  // initial grid render
  renderGrid();
</script>
</body>
</html>
